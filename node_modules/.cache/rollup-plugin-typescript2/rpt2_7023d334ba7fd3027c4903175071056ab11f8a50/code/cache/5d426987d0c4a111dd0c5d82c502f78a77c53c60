{"code":"import invariant from 'tiny-invariant';\r\nimport { Price } from '../entities';\r\n/**\r\n * Represents a list of pools through which a swap can occur\r\n * @template TInput The input token\r\n * @template TOutput The output token\r\n */\r\nexport class Route {\r\n    /**\r\n     * Creates an instance of route.\r\n     * @param pools An array of `Pool` objects, ordered by the route the swap will take\r\n     * @param input The input token\r\n     * @param output The output token\r\n     */\r\n    constructor(pools, input, output) {\r\n        this._midPrice = null;\r\n        invariant(pools.length > 0, 'POOLS');\r\n        const chainId = pools[0].chainId;\r\n        const allOnSameChain = pools.every(pool => pool.chainId === chainId);\r\n        invariant(allOnSameChain, 'CHAIN_IDS');\r\n        const wrappedInput = input.wrapped;\r\n        invariant(pools[0].involvesToken(wrappedInput), 'INPUT');\r\n        invariant(pools[pools.length - 1].involvesToken(output.wrapped), 'OUTPUT');\r\n        /**\r\n         * Normalizes token0-token1 order and selects the next token/fee step to add to the path\r\n         * */\r\n        const tokenPath = [wrappedInput];\r\n        for (const [i, pool] of pools.entries()) {\r\n            const currentInputToken = tokenPath[i];\r\n            invariant(currentInputToken.equals(pool.token0) ||\r\n                currentInputToken.equals(pool.token1), 'PATH');\r\n            const nextToken = currentInputToken.equals(pool.token0)\r\n                ? pool.token1\r\n                : pool.token0;\r\n            tokenPath.push(nextToken);\r\n        }\r\n        this.pools = pools;\r\n        this.tokenPath = tokenPath;\r\n        this.input = input;\r\n        this.output = output ?? tokenPath[tokenPath.length - 1];\r\n    }\r\n    /**\r\n     * Returns the mid price of the route\r\n     */\r\n    get midPrice() {\r\n        if (this._midPrice !== null)\r\n            return this._midPrice;\r\n        const price = this.pools.slice(1).reduce(({ nextInput, price }, pool) => {\r\n            return nextInput.equals(pool.token0)\r\n                ? {\r\n                    nextInput: pool.token1,\r\n                    price: price.multiply(pool.token0Price),\r\n                }\r\n                : {\r\n                    nextInput: pool.token0,\r\n                    price: price.multiply(pool.token1Price),\r\n                };\r\n        }, this.pools[0].token0.equals(this.input.wrapped)\r\n            ? {\r\n                nextInput: this.pools[0].token1,\r\n                price: this.pools[0].token0Price,\r\n            }\r\n            : {\r\n                nextInput: this.pools[0].token0,\r\n                price: this.pools[0].token1Price,\r\n            }).price;\r\n        return (this._midPrice = new Price(this.input, this.output, price.denominator, price.numerator));\r\n    }\r\n    get chainId() {\r\n        return this.pools[0].chainId;\r\n    }\r\n}\r\n//# sourceMappingURL=route.js.map","references":["D:/personal_programming_work/integral-sdk-hpot/node_modules/tiny-invariant/dist/tiny-invariant.d.ts","D:/personal_programming_work/integral-sdk-hpot/src/entities/index.ts","D:/personal_programming_work/integral-sdk-hpot/src/entities/pool.ts"],"map":"{\"version\":3,\"file\":\"route.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/entities/route.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,SAAS,MAAM,gBAAgB,CAAC;AAEvC,OAAO,EAAY,KAAK,EAAS,MAAM,aAAa,CAAC;AAGrD;;;;GAIG;AACH,MAAM,OAAO,KAAK;IAMhB;;;;;OAKG;IACH,YAAmB,KAAa,EAAE,KAAa,EAAE,MAAe;QAmCxD,cAAS,GAAkC,IAAI,CAAC;QAlCtD,SAAS,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,OAAO,CAAC,CAAC;QAErC,MAAM,OAAO,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;QACjC,MAAM,cAAc,GAAG,KAAK,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,KAAK,OAAO,CAAC,CAAC;QACrE,SAAS,CAAC,cAAc,EAAE,WAAW,CAAC,CAAC;QAEvC,MAAM,YAAY,GAAG,KAAK,CAAC,OAAO,CAAC;QACnC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,OAAO,CAAC,CAAC;QAEzD,SAAS,CAAC,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,aAAa,CAAC,MAAM,CAAC,OAAO,CAAC,EAAE,QAAQ,CAAC,CAAC;QAE3E;;aAEK;QACL,MAAM,SAAS,GAAY,CAAC,YAAY,CAAC,CAAC;QAC1C,KAAK,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,EAAE,EAAE;YACvC,MAAM,iBAAiB,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;YACvC,SAAS,CACP,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBACrC,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EACrC,MAAM,CACP,CAAC;YACF,MAAM,SAAS,GAAG,iBAAiB,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBACrD,CAAC,CAAC,IAAI,CAAC,MAAM;gBACb,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC;YAChB,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;SAC3B;QAED,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,MAAM,GAAG,MAAM,IAAI,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;IAC1D,CAAC;IAID;;OAEG;IACH,IAAW,QAAQ;QACjB,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI;YAAE,OAAO,IAAI,CAAC,SAAS,CAAC;QAEnD,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CACtC,CAAC,EAAE,SAAS,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,EAAE;YAC7B,OAAO,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;gBAClC,CAAC,CAAC;oBACA,SAAS,EAAE,IAAI,CAAC,MAAM;oBACtB,KAAK,EAAE,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC;iBACxC;gBACD,CAAC,CAAC;oBACA,SAAS,EAAE,IAAI,CAAC,MAAM;oBACtB,KAAK,EAAE,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC;iBACxC,CAAC;QACN,CAAC,EACD,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC;YAC7C,CAAC,CAAC;gBACA,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM;gBAC/B,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,WAAW;aACjC;YACD,CAAC,CAAC;gBACA,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM;gBAC/B,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,WAAW;aACjC,CACJ,CAAC,KAAK,CAAC;QAER,OAAO,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,KAAK,CAChC,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,MAAM,EACX,KAAK,CAAC,WAAW,EACjB,KAAK,CAAC,SAAS,CAChB,CAAC,CAAC;IACL,CAAC;IAED,IAAW,OAAO;QAChB,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;IAC/B,CAAC;CACF\"}"}
